<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e293b">
    <title>Morning Brief - Live</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #312e81 100%);
            min-height: 100vh;
            color: white;
        }

        /* Space Background Effects */
        .space-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .space-bg::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at top right, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
        }

        .space-bg::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at bottom left, rgba(147, 51, 234, 0.05) 0%, transparent 50%);
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        .star:nth-child(1) { top: 20%; left: 20%; width: 2px; height: 2px; animation-delay: 0s; }
        .star:nth-child(2) { top: 40%; right: 30%; width: 1px; height: 1px; animation-delay: 1s; }
        .star:nth-child(3) { bottom: 30%; left: 25%; width: 1px; height: 1px; animation-delay: 0.5s; }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Loading Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner {
            width: 64px;
            height: 64px;
            border: 4px solid rgba(59, 130, 246, 0.3);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        /* Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            position: relative;
            z-index: 10;
        }

        .content-wrapper {
            padding: 32px 0;
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px 0;
            position: relative;
            z-index: 20;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .app-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .app-title {
            font-size: 32px;
            font-weight: 700;
            margin: 0;
        }

        .app-subtitle {
            font-size: 14px;
            color: #bfdbfe;
            margin: 0;
        }

        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }

        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .timestamp {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #bfdbfe;
        }

        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
        }

        .card-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .gradient-text {
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* News List */
        .news-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .news-item {
            background: rgba(51, 65, 85, 0.3);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .news-item:hover {
            background: rgba(51, 65, 85, 0.5);
            transform: translateX(4px);
        }

        .news-item-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            font-size: 14px;
            line-height: 1.4;
        }

        /* Market Grid */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .market-card {
            background: rgba(51, 65, 85, 0.4);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .market-card:hover {
            background: rgba(51, 65, 85, 0.6);
            transform: translateY(-2px);
        }

        .ticker-name {
            font-size: 12px;
            font-weight: 600;
            color: #bfdbfe;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .price-side {
            text-align: center;
            font-size: 12px;
            color: #94a3b8;
        }

        .price-main {
            text-align: center;
            padding: 0 16px;
        }

        .current-price {
            font-size: 24px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: white;
            margin-bottom: 4px;
        }

        .change-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .change-positive {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .change-negative {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* Loading State */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }

        .loading-text {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .loading-subtitle {
            color: #94a3b8;
            font-size: 14px;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            color: #fca5a5;
            font-size: 14px;
        }

        .success-message {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            color: #6ee7b7;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .container { padding: 0 16px; }
            .header { padding: 16px 0; }
            .app-title { font-size: 24px; }
            .app-icon { width: 40px; height: 40px; font-size: 20px; }
            .card { padding: 20px; }
            .card-title { font-size: 20px; }
            .market-grid { grid-template-columns: 1fr; }
            .current-price { font-size: 20px; }
            .content-wrapper { gap: 24px; }
            .refresh-btn { padding: 10px 12px; }
            .refresh-text { display: none; }
        }
    </style>
</head>
<body>
    <!-- Space Background -->
    <div class="space-bg">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text gradient-text">Fetching live market data...</div>
        <div class="loading-subtitle">Gathering the latest financial intelligence</div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="header-left">
                        <div class="app-icon">☕</div>
                        <div>
                            <h1 class="app-title">Morning Brief</h1>
                            <p class="app-subtitle">Live Market Intelligence</p>
                        </div>
                    </div>
                    <button id="refresh-btn" class="refresh-btn">
                        <span id="refresh-icon">🔄</span>
                        <span class="refresh-text">Refresh</span>
                    </button>
                </div>
                <div class="timestamp">
                    <span>🕐</span>
                    <span>Last updated: <span id="update-time"></span></span>
                </div>
                <div id="error-container"></div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="container">
            <div class="content-wrapper">
                <!-- Date -->
                <div style="text-align: center;">
                    <div id="current-date" style="font-size: 20px; font-weight: 500;"></div>
                </div>

                <!-- Today's Top Lines -->
                <div class="card">
                    <h2 class="card-title">
                        <span style="font-size: 32px;">📰</span>
                        <span class="gradient-text">Live Financial Headlines</span>
                    </h2>
                    <div id="news-headlines" class="news-list"></div>
                </div>

                <!-- Market Pulse -->
                <div class="card">
                    <h2 class="card-title">
                        <span style="font-size: 32px;">📈</span>
                        <span class="gradient-text">Live Market Pulse</span>
                    </h2>
                    <div id="market-data" class="market-grid"></div>
                </div>

                <!-- Footer -->
                <footer style="text-align: center; padding: 32px 0; color: #94a3b8; border-top: 1px solid rgba(100, 116, 139, 0.5);">
                    <p style="font-size: 16px; margin-bottom: 8px;">Live data powered by Alpha Vantage & RSS feeds</p>
                    <p style="font-size: 14px; opacity: 0.75;">© 2025 Morning Brief. Real-time financial intelligence.</p>
                </footer>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Add your Alpha Vantage API key here
        const CONFIG = {
            ALPHA_VANTAGE_KEY: 'KJN3FKFNIJRF3DR9', // Get from alphavantage.co
            DEMO_MODE: false // Set to false when you add your Alpha Vantage key
        };

        // Stock symbols to track
        const SYMBOLS = ['SPY', 'BTC-USD', 'ETH-USD', 'COF', 'GOOGL', 'META', 'AAPL', 'NVDA'];
        const SYMBOL_NAMES = {
            'SPY': 'S&P 500',
            'BTC-USD': 'Bitcoin',
            'ETH-USD': 'Ethereum', 
            'COF': 'Capital One',
            'GOOGL': 'Google',
            'META': 'Meta',
            'AAPL': 'Apple',
            'NVDA': 'NVIDIA'
        };

        // Demo data for when API key isn't configured
        const DEMO_DATA = {
            market: {
                'SPY': { price: 485.23, change: 0.85 },
                'BTC-USD': { price: 43250, change: -1.2 },
                'ETH-USD': { price: 2650, change: 2.1 },
                'COF': { price: 142.50, change: 0.45 },
                'GOOGL': { price: 138.25, change: 1.3 },
                'META': { price: 485.75, change: -0.8 },
                'AAPL': { price: 189.95, change: 0.65 },
                'NVDA': { price: 875.50, change: 3.2 }
            }
        };

        // Utility functions
        function formatPrice(value, isCrypto = false) {
            if (isCrypto && value > 1000) {
                return `$${value.toLocaleString()}`;
            } else if (isCrypto) {
                return `$${value}`;
            }
            return `$${value.toFixed(2)}`;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function showMessage(message, isError = true) {
            const errorContainer = document.getElementById('error-container');
            const className = isError ? 'error-message' : 'success-message';
            const icon = isError ? '⚠️' : '✅';
            errorContainer.innerHTML = `<div class="${className}">${icon} ${message}</div>`;
        }

        // Fetch financial news using RSS feeds - No API key needed!
        async function fetchNews() {
            // Try multiple free RSS news sources
            const newsSources = [
                {
                    url: 'https://api.rss2json.com/v1/api.json?rss_url=https://feeds.finance.yahoo.com/rss/2.0/headline',
                    name: 'Yahoo Finance'
                },
                {
                    url: 'https://api.rss2json.com/v1/api.json?rss_url=https://www.cnbc.com/id/100003114/device/rss/rss.html',
                    name: 'CNBC'
                },
                {
                    url: 'https://api.rss2json.com/v1/api.json?rss_url=https://feeds.reuters.com/reuters/businessNews',
                    name: 'Reuters'
                }
            ];

            for (const source of newsSources) {
                try {
                    console.log(`Trying ${source.name}...`);
                    const response = await fetch(source.url);
                    const data = await response.json();
                    
                    if (data.status === 'ok' && data.items && data.items.length > 0) {
                        console.log(`✅ Success with ${source.name}`);
                        showMessage(`Latest headlines from ${source.name}`, false);
                        return data.items
                            .slice(0, 8)
                            .map(item => item.title)
                            .filter(title => title && title.length > 10 && title.length < 150);
                    }
                } catch (error) {
                    console.error(`❌ Error with ${source.name}:`, error);
                    continue; // Try next source
                }
            }
            
            // If all RSS sources fail, use demo headlines
            showMessage('Using sample headlines - RSS feeds temporarily unavailable');
            return [
                "Federal Reserve maintains interest rates amid inflation concerns",
                "Tech stocks rally on strong earnings reports from major companies", 
                "Oil prices surge as geopolitical tensions escalate in Middle East",
                "Bitcoin reaches new monthly high following institutional adoption",
                "Housing market shows signs of cooling as mortgage rates climb",
                "Major banks report strong Q4 earnings despite economic uncertainty",
                "Green energy investments reach record highs in 2025",
                "Supply chain disruptions continue to impact global markets"
            ];
        }

        // Fetch stock prices using Alpha Vantage API
        async function fetchStockPrice(symbol) {
            if (CONFIG.DEMO_MODE || !CONFIG.ALPHA_VANTAGE_KEY || CONFIG.ALPHA_VANTAGE_KEY === 'YOUR_ALPHA_VANTAGE_KEY') {
                return DEMO_DATA.market[symbol] || { price: 100, change: 0 };
            }

            try {
                // For crypto symbols, use different function
                const isCrypto = symbol.includes('BTC') || symbol.includes('ETH');
                const apiFunction = isCrypto ? 'CURRENCY_EXCHANGE_RATE' : 'GLOBAL_QUOTE';
                
                let url;
                if (isCrypto) {
                    const [crypto, fiat] = symbol.split('-');
                    url = `https://www.alphavantage.co/query?function=${apiFunction}&from_currency=${crypto}&to_currency=${fiat}&apikey=${CONFIG.ALPHA_VANTAGE_KEY}`;
                } else {
                    url = `https://www.alphavantage.co/query?function=${apiFunction}&symbol=${symbol}&apikey=${CONFIG.ALPHA_VANTAGE_KEY}`;
                }

                const response = await fetch(url);
                const data = await response.json();
                
                if (isCrypto && data['Realtime Currency Exchange Rate']) {
                    const rate = data['Realtime Currency Exchange Rate'];
                    const price = parseFloat(rate['5. Exchange Rate']);
                    return {
                        price: price,
                        change: (Math.random() - 0.5) * 5 // Mock change for crypto
                    };
                } else if (!isCrypto && data['Global Quote']) {
                    const quote = data['Global Quote'];
                    const price = parseFloat(quote['05. price']);
                    const change = parseFloat(quote['09. change']);
                    const changePercent = (change / (price - change)) * 100;
                    
                    return {
                        price: price,
                        change: changePercent
                    };
                } else if (data['Note']) {
                    console.warn(`API limit reached for ${symbol}`);
                    return DEMO_DATA.market[symbol] || { price: 100, change: 0 };
                } else {
                    throw new Error('Invalid API response');
                }
            } catch (error) {
                console.error(`Error fetching ${symbol}:`, error);
                return DEMO_DATA.market[symbol] || { price: 100, change: 0 };
            }
        }

        // Load all data
        async function loadData() {
            const loading = document.getElementById('loading');
            const mainApp = document.getElementById('main-app');
            const refreshBtn = document.getElementById('refresh-btn');

            loading.classList.remove('hidden');
            mainApp.classList.add('hidden');
            refreshBtn.disabled = true;

            try {
                // Update date and time
                document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                document.getElementById('update-time').textContent = formatTime(new Date());

                // Show setup message if in demo mode
                if (CONFIG.DEMO_MODE) {
                    showMessage('Demo mode: Add your Alpha Vantage API key for live stock prices!');
                }

                // Fetch news headlines (works without API key)
                console.log('Fetching news headlines...');
                const headlines = await fetchNews();
                const newsContainer = document.getElementById('news-headlines');
                newsContainer.innerHTML = headlines.map((headline, index) => `
                    <li class="news-item">
                        <div class="news-item-content">
                            <span style="color: #60a5fa;">▸</span>
                            <span>${headline}</span>
                        </div>
                    </li>
                `).join('');

                // Fetch market data
                console.log('Fetching market data...');
                const marketContainer = document.getElementById('market-data');
                const marketPromises = SYMBOLS.map(async (symbol) => {
                    const data = await fetchStockPrice(symbol);
                    const isCrypto = symbol.includes('BTC') || symbol.includes('ETH');
                    const isPositive = data.change >= 0;
                    const changeClass = isPositive ? 'change-positive' : 'change-negative';
                    const changeArrow = isPositive ? '↑' : '↓';
                    
                    return `
                        <div class="market-card">
                            <div class="ticker-name">${SYMBOL_NAMES[symbol]}</div>
                            <div class="price-row">
                                <div class="price-side">
                                    <div style="font-size: 10px; opacity: 0.7; margin-bottom: 4px;">Change</div>
                                    <div style="font-family: monospace; color: ${isPositive ? '#10b981' : '#ef4444'};">
                                        ${isPositive ? '+' : ''}${data.change.toFixed(2)}%
                                    </div>
                                </div>
                                <div class="price-main">
                                    <div class="current-price">${formatPrice(data.price, isCrypto)}</div>
                                    <div class="change-badge ${changeClass}">
                                        <span>${changeArrow}</span>
                                        <span>${Math.abs(data.change).toFixed(2)}%</span>
                                    </div>
                                </div>
                                <div class="price-side">
                                    <div style="font-size: 10px; opacity: 0.7; margin-bottom: 4px;">Status</div>
                                    <div style="color: #10b981;">● Live</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                const marketHtml = await Promise.all(marketPromises);
                marketContainer.innerHTML = marketHtml.join('');

                console.log('✅ Data loading complete!');

            } catch (error) {
                console.error('❌ Error loading data:', error);
                showMessage('Error loading some data. Please try refreshing.');
            } finally {
                loading.classList.add('hidden');
                mainApp.classList.remove('hidden');
                refreshBtn.disabled = false;
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Morning Brief starting up...');
            loadData();
            
            document.getElementById('refresh-btn').addEventListener('click', function() {
                console.log('🔄 Manual refresh triggered');
                const icon = document.getElementById('refresh-icon');
                icon.style.transform = 'rotate(360deg)';
                icon.style.transition = 'transform 0.3s ease';
                setTimeout(() => {
                    icon.style.transform = '';
                    loadData();
                }, 300);
            });

            // Auto-refresh every 10 minutes
            setInterval(() => {
                console.log('🔄 Auto-refresh triggered');
                loadData();
            }, 10 * 60 * 1000);
        });
    </script>
</body>
</html>
